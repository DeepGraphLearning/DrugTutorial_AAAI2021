

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Retrosynthesis &mdash; Drugdiscovery 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Link Prediction" href="link_prediction.html" />
    <link rel="prev" title="Molecule Generation" href="generation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Drugdiscovery
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick Start</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmark</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../benchmark/property_prediction.html">Molecule Property Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmark/generation.html">Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmark/retrosynthesis.html">Retrosynthesis</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="property_prediction.html">Molecule Property Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="generation.html">Molecule Generation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Retrosynthesis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prepare-the-dataset">Prepare the Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#center-identification">Center Identification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#synthon-completion">Synthon Completion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Retrosynthesis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="link_prediction.html">Link Prediction</a></li>
</ul>
<p class="caption"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notes/graph.html">Graph Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/layer.html">Graph Neural Network Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/variadic.html">Batch Irregular Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/debug.html">Debug Your Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/extension.html">Custom Extensions</a></li>
</ul>
<p class="caption"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/core.html">drugdiscovery.core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/data.html">drugdiscovery.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/datasets.html">drugdiscovery.datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/layers.html">drugdiscovery.layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/models.html">drugdiscovery.models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/tasks.html">drugdiscovery.tasks</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Drugdiscovery</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Retrosynthesis</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/examples/retrosynthesis.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="retrosynthesis">
<h1>Retrosynthesis<a class="headerlink" href="#retrosynthesis" title="Permalink to this headline">¶</a></h1>
<p>Retrosynthesis is a fundamental task in drug discovery. Given a target molecule,
the goal of retrosynthesis is to identify a set of reactants that can produce
the target.</p>
<p>In this example, we will show how to predict retrosynthesis using <a class="reference external" href="https://arxiv.org/pdf/2003.12725.pdf">G2Gs</a> framework.
<a class="reference external" href="https://arxiv.org/pdf/2003.12725.pdf">G2Gs</a> first identifies the reaction centers, i.e., bonds generated in the
product. Based on the reaction centers, the product is broken into several
synthons and each synthon is translated to a reactant.</p>
<div class="section" id="prepare-the-dataset">
<h2>Prepare the Dataset<a class="headerlink" href="#prepare-the-dataset" title="Permalink to this headline">¶</a></h2>
<p>We use the standard <a class="reference external" href="https://aspace.repository.cam.ac.uk/bitstream/handle/1810/244727/lowethesis.pdf">USPTO50k</a> dataset. This dataset contains 50k molecules and
their synthesis pathways.</p>
<p>First, let’s download and load the dataset. This may take a while.</p>
<p>There are two modes to load the dataset. The reaction mode loads the dataset as
<cite>(reactant, product)</cite> pairs, which is used for center identification. The synthon
mode loads the dataset as <cite>(reactant, synthon)</cite> pairs, which is used for synthon
completion.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">drugdiscovery</span> <span class="kn">import</span> <span class="n">datasets</span>

<span class="n">reaction_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">USPTO50k</span><span class="p">(</span><span class="s2">&quot;~/molecule-datasets/&quot;</span><span class="p">,</span>
                                     <span class="n">node_feature</span><span class="o">=</span><span class="s2">&quot;reaction_reaction_identification&quot;</span><span class="p">,</span>
                                     <span class="n">kekulize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">synthon_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">USPTO50k</span><span class="p">(</span><span class="s2">&quot;~/molecule-dataset/&quot;</span><span class="p">,</span> <span class="n">as_synthon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="n">node_feature</span><span class="o">=</span><span class="s2">&quot;synthon_completion&quot;</span><span class="p">,</span>
                                    <span class="n">kekulize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we visualize some samples from the dataset. For the reaction dataset, we can
split reactant and product graphs into individual molecules using
<a class="reference internal" href="../api/data.html#drugdiscovery.data.Graph.connected_components" title="drugdiscovery.data.Graph.connected_components"><code class="xref py py-meth docutils literal notranslate"><span class="pre">connected_components()</span></code></a>.
Note <a class="reference external" href="https://aspace.repository.cam.ac.uk/bitstream/handle/1810/244727/lowethesis.pdf">USPTO50k</a> ignores all non-target products, so there is only one product on
the right hand side.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">drugdiscovery.utils</span> <span class="kn">import</span> <span class="n">plot</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">reaction_dataset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">reactant</span><span class="p">,</span> <span class="n">product</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;graph&quot;</span><span class="p">]</span>
    <span class="n">reactants</span> <span class="o">=</span> <span class="n">reactant</span><span class="o">.</span><span class="n">connected_components</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">products</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">connected_components</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">reaction</span><span class="p">(</span><span class="n">reactants</span><span class="p">,</span> <span class="n">products</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/uspto50k_0.png"><img alt="../_images/uspto50k_0.png" src="../_images/uspto50k_0.png" style="width: 49%;" /></a>
<a class="reference internal image-reference" href="../_images/uspto50k_1.png"><img alt="../_images/uspto50k_1.png" src="../_images/uspto50k_1.png" style="width: 49%;" /></a>
<p>Here are the corresponding samples in the synthon dataset.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">synthon_dataset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">reactant</span><span class="p">,</span> <span class="n">synthon</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;graph&quot;</span><span class="p">]</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">reaction</span><span class="p">([</span><span class="n">reactant</span><span class="p">],</span> <span class="p">[</span><span class="n">synthon</span><span class="p">])</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/uspto50k_synthon_0.png"><img alt="../_images/uspto50k_synthon_0.png" src="../_images/uspto50k_synthon_0.png" style="width: 49%;" /></a>
<a class="reference internal image-reference" href="../_images/uspto50k_synthon_1.png"><img alt="../_images/uspto50k_synthon_1.png" src="../_images/uspto50k_synthon_1.png" style="width: 24%;" /></a>
<a class="reference internal image-reference" href="../_images/uspto50k_synthon_2.png"><img alt="../_images/uspto50k_synthon_2.png" src="../_images/uspto50k_synthon_2.png" style="width: 24%;" /></a>
<p>To ensure the same split is used by both datasets, we can set the random seed
before calling <code class="xref py py-meth docutils literal notranslate"><span class="pre">split()</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">reaction_train</span><span class="p">,</span> <span class="n">reaction_valid</span><span class="p">,</span> <span class="n">reaction_test</span> <span class="o">=</span> <span class="n">reaction_dataset</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">synthon_train</span><span class="p">,</span> <span class="n">synthon_valid</span><span class="p">,</span> <span class="n">synthon_test</span> <span class="o">=</span> <span class="n">synthon_dataset</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="center-identification">
<h2>Center Identification<a class="headerlink" href="#center-identification" title="Permalink to this headline">¶</a></h2>
<p>Now we define our model. We use a Relational Graph Convolutional Network (RGCN)
as our representation model, and wrap it for the center identification task. Note
other graph representation learning models can also be used here.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">drugdiscovery</span> <span class="kn">import</span> <span class="n">core</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">tasks</span>

<span class="n">reaction_model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">RGCN</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">node_feature_dim</span><span class="p">,</span>
                    <span class="n">hidden_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">],</span>
                    <span class="n">num_relation</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">num_bond_type</span><span class="p">,</span>
                    <span class="n">concat_hidden</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">reaction_task</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">CenterIdentification</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">feature</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;graph&quot;</span><span class="p">,</span> <span class="s2">&quot;atom&quot;</span><span class="p">,</span> <span class="s2">&quot;bond&quot;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reaction_optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">reaction_task</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
<span class="n">reaction_solver</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Engine</span><span class="p">(</span><span class="n">reaction_task</span><span class="p">,</span> <span class="n">reaction_train</span><span class="p">,</span> <span class="n">reaction_valid</span><span class="p">,</span> <span class="n">reaction_test</span><span class="p">,</span>
                              <span class="n">optimizer</span><span class="p">,</span> <span class="n">gpus</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="n">reaction_solver</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">num_epoch</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">reaction_solver</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;valid&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The evaluation result on the validation set may look like</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>accuracy: <span class="m">0</span>.836367
</pre></div>
</div>
<p>We can show some predictions from our model. For diversity, we collect samples
from 4 different reaction types.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">batch</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">reaction_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">reaction_valid</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;reaction&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reaction_set</span><span class="p">:</span>
        <span class="n">reaction_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;reaction&quot;</span><span class="p">])</span>
        <span class="n">batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">break</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">graph_collate</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">cuda</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">reaction_task</span><span class="o">.</span><span class="n">predict_synthon</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</pre></div>
</div>
<p>The following code visualizes the ground truths as well as our predictions on the
samples. We use blue for ground truths, red for wrong predictions, and purple for
correct predictions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">atoms_and_bonds</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">reaction_center</span><span class="p">):</span>
    <span class="n">is_reaction_atom</span> <span class="o">=</span> <span class="p">(</span><span class="n">molecule</span><span class="o">.</span><span class="n">atom_map</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> \
                       <span class="p">(</span><span class="n">molecule</span><span class="o">.</span><span class="n">atom_map</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> \
                        <span class="n">reaction_center</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">node_in</span><span class="p">,</span> <span class="n">node_out</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">edge_list</span><span class="o">.</span><span class="n">t</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">edge_map</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">atom_map</span><span class="p">[</span><span class="n">molecule</span><span class="o">.</span><span class="n">edge_list</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]]</span>
    <span class="n">is_reaction_bond</span> <span class="o">=</span> <span class="p">(</span><span class="n">edge_map</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> \
                       <span class="p">(</span><span class="n">edge_map</span> <span class="o">==</span> <span class="n">reaction_center</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">atoms</span> <span class="o">=</span> <span class="n">is_reaction_atom</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">bonds</span> <span class="o">=</span> <span class="n">is_reaction_bond</span><span class="p">[</span><span class="n">node_in</span> <span class="o">&lt;</span> <span class="n">node_out</span><span class="p">]</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">bonds</span>

<span class="n">products</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;graph&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">reaction_centers</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;reaction_center&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">product</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">products</span><span class="p">):</span>
    <span class="n">true_atoms</span><span class="p">,</span> <span class="n">true_bonds</span> <span class="o">=</span> <span class="n">atoms_and_bonds</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">product</span><span class="o">.</span><span class="n">reaction_center</span><span class="p">)</span>
    <span class="n">true_atoms</span><span class="p">,</span> <span class="n">true_bonds</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">true_atoms</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="n">true_bonds</span><span class="p">)</span>
    <span class="n">pred_atoms</span><span class="p">,</span> <span class="n">pred_bonds</span> <span class="o">=</span> <span class="n">atoms_and_bonds</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">reaction_centers</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">pred_atoms</span><span class="p">,</span> <span class="n">pred_bonds</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">pred_atoms</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="n">pred_bonds</span><span class="p">)</span>
    <span class="n">overlap_atoms</span> <span class="o">=</span> <span class="n">true_atoms</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">pred_atoms</span><span class="p">)</span>
    <span class="n">overlap_bonds</span> <span class="o">=</span> <span class="n">true_bonds</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">pred_bonds</span><span class="p">)</span>
    <span class="n">atoms</span> <span class="o">=</span> <span class="n">true_atoms</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">pred_atoms</span><span class="p">)</span>
    <span class="n">bonds</span> <span class="o">=</span> <span class="n">true_bonds</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">pred_bonds</span><span class="p">)</span>

    <span class="n">red</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">blue</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">purple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">atom_colors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">bond_colors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">overlap_atoms</span><span class="p">:</span>
            <span class="n">atom_colors</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="n">purple</span>
        <span class="k">elif</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">pred_atoms</span><span class="p">:</span>
            <span class="n">atom_colors</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="n">red</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">atom_colors</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="n">blue</span>
    <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">bonds</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">overlap_bonds</span><span class="p">:</span>
            <span class="n">bond_colors</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span> <span class="o">=</span> <span class="n">purple</span>
        <span class="k">elif</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">pred_bonds</span><span class="p">:</span>
            <span class="n">bond_colors</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span> <span class="o">=</span> <span class="n">red</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bond_colors</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span> <span class="o">=</span> <span class="n">blue</span>

    <span class="n">plot</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">bonds</span><span class="p">,</span> <span class="n">atom_colors</span><span class="p">,</span> <span class="n">bond_colors</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/uspto50k_reaction_g2gs_valid_0.png"><img alt="../_images/uspto50k_reaction_g2gs_valid_0.png" src="../_images/uspto50k_reaction_g2gs_valid_0.png" style="width: 24%;" /></a>
<a class="reference internal image-reference" href="../_images/uspto50k_reaction_g2gs_valid_1.png"><img alt="../_images/uspto50k_reaction_g2gs_valid_1.png" src="../_images/uspto50k_reaction_g2gs_valid_1.png" style="width: 24%;" /></a>
<a class="reference internal image-reference" href="../_images/uspto50k_reaction_g2gs_valid_2.png"><img alt="../_images/uspto50k_reaction_g2gs_valid_2.png" src="../_images/uspto50k_reaction_g2gs_valid_2.png" style="width: 24%;" /></a>
<a class="reference internal image-reference" href="../_images/uspto50k_reaction_g2gs_valid_3.png"><img alt="../_images/uspto50k_reaction_g2gs_valid_3.png" src="../_images/uspto50k_reaction_g2gs_valid_3.png" style="width: 24%;" /></a>
</div>
<div class="section" id="synthon-completion">
<h2>Synthon Completion<a class="headerlink" href="#synthon-completion" title="Permalink to this headline">¶</a></h2>
<p>Similarly, we train a synthon completion model on the synthon dataset.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">synthon_model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">RGCN</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">node_feature_dim</span><span class="p">,</span>
                            <span class="n">hidden_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">],</span>
                            <span class="n">num_relation</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">num_bond_type</span><span class="p">,</span>
                            <span class="n">concat_hidden</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">synthon_task</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">SynthonCompletion</span><span class="p">(</span><span class="n">synthon_model</span><span class="p">,</span> <span class="n">feature</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;graph&quot;</span><span class="p">,))</span>

<span class="n">synthon_optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">synthon_task</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
<span class="n">synthon_solver</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Engine</span><span class="p">(</span><span class="n">synthon_task</span><span class="p">,</span> <span class="n">synthon_train</span><span class="p">,</span> <span class="n">synthon_valid</span><span class="p">,</span> <span class="n">synthon_test</span><span class="p">,</span>
                             <span class="n">optimizer</span><span class="p">,</span> <span class="n">gpus</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="n">synthon_solver</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">num_epoch</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">synthon_solver</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;valid&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We may obtain some results like</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bond accuracy: <span class="m">0</span>.983013
node in accuracy: <span class="m">0</span>.967535
node out accuracy: <span class="m">0</span>.892999
stop accuracy: <span class="m">0</span>.929348
total accuracy: <span class="m">0</span>.844374
</pre></div>
</div>
<p>We then perform beam search to generate reactant candidates.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">batch</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">reaction_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">synthon_valid</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;reaction&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reaction_set</span><span class="p">:</span>
        <span class="n">reaction_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;reaction&quot;</span><span class="p">])</span>
        <span class="n">batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">break</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">graph_collate</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">cuda</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
<span class="n">reactants</span><span class="p">,</span> <span class="n">synthons</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;graph&quot;</span><span class="p">]</span>
<span class="n">reactants</span> <span class="o">=</span> <span class="n">reactants</span><span class="o">.</span><span class="n">ion_to_molecule</span><span class="p">()</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">synthon_task</span><span class="o">.</span><span class="n">predict_reactant</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">num_beam</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_prediction</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">synthon_id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">graphs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">synthon_id</span> <span class="o">!=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">synthon_id</span><span class="p">:</span>
        <span class="n">synthon_id</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">synthon_id</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">graphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reactants</span><span class="p">[</span><span class="n">synthon_id</span><span class="p">])</span>
        <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Truth </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">synthon_id</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">graphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reactants</span><span class="p">[</span><span class="n">synthon_id</span><span class="p">]</span> <span class="o">==</span> <span class="n">prediction</span><span class="p">:</span>
        <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Prediction </span><span class="si">%d</span><span class="s2">-</span><span class="si">%d</span><span class="s2">, Correct!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">synthon_id</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Prediction </span><span class="si">%d</span><span class="s2">-</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">synthon_id</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

<span class="c1"># reset attributes so that pack can work properly</span>
<span class="n">mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">graph</span><span class="o">.</span><span class="n">to_molecule</span><span class="p">()</span> <span class="k">for</span> <span class="n">graph</span> <span class="ow">in</span> <span class="n">graphs</span><span class="p">]</span>
<span class="n">graphs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">PackedMolecule</span><span class="o">.</span><span class="n">from_molecule</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span>
<span class="n">graphs</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">titles</span><span class="p">,</span> <span class="n">save_file</span><span class="o">=</span><span class="s2">&quot;uspto50k_synthon_valid.png&quot;</span><span class="p">,</span> <span class="n">num_col</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<p>For each row in the visualization, the first molecule corresponds to the ground truth.
The rest molecules are candidates from beam search, ordered by their log likelihood.
We can see that our model can recall ground truth in top-5 predictions for most samples.</p>
<img alt="../_images/uspto50k_synthon_g2gs_valid.png" src="../_images/uspto50k_synthon_g2gs_valid.png" />
</div>
<div class="section" id="id1">
<h2>Retrosynthesis<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Given the trained models, we can combine them into an end2end pipeline for
retrosynthesis. This is done by wrapping the two sub tasks with a retrosynthesis task.</p>
<p>The pipeline will perform beam search over all possible combinations between the
predictions from two sub tasks. For demonstration, we use a small beam size and
only evaluate on a subset of the validation set. Note the results will be better
if we give more budget to the beam search.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">reaction_valid</span><span class="p">)</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">reaction_valid</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">reaction_valid</span><span class="p">)</span> <span class="o">//</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">reaction_valid_small</span> <span class="o">=</span> <span class="n">torch_data</span><span class="o">.</span><span class="n">random_split</span><span class="p">(</span><span class="n">reaction_valid</span><span class="p">,</span> <span class="n">lengths</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">task</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="n">Retrosynthesis</span><span class="p">(</span><span class="n">reaction_task</span><span class="p">,</span> <span class="n">synthon_task</span><span class="p">,</span> <span class="n">center_topk</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_beam</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                            <span class="n">max_prediction</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Engine</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">reaction_train</span><span class="p">,</span> <span class="n">reaction_valid_small</span><span class="p">,</span> <span class="n">reaction_test</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span>
                     <span class="n">gpus</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</pre></div>
</div>
<p>To load parameters two sub tasks, we just load each checkpoint. Note <code class="docutils literal notranslate"><span class="pre">load_optimizer</span></code>
should be set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to avoid conflicts.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reaction_solver</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;g2gs_reaction_model.pth&quot;</span><span class="p">)</span>
<span class="n">synthon_solver</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;g2gs_synthon_model.pth&quot;</span><span class="p">)</span>

<span class="n">reaction_task</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">reaction_train</span><span class="p">)</span>
<span class="n">synthon_task</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">synthon_train</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;g2gs_reaction_model.pth&quot;</span><span class="p">,</span> <span class="n">load_optimizer</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;g2gs_synthon_model.pth&quot;</span><span class="p">,</span> <span class="n">load_optimizer</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;valid&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The accuracy for retrosynthesis may be close to the following.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>top-1 accuracy: <span class="m">0</span>.47541
top-3 accuracy: <span class="m">0</span>.741803
top-5 accuracy: <span class="m">0</span>.827869
top-10 accuracy: <span class="m">0</span>.879098
</pre></div>
</div>
<p>Here are the top-1 predictions for samples in the validation set.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">batch</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">reaction_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">reaction_valid</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;reaction&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reaction_set</span><span class="p">:</span>
        <span class="n">reaction_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;reaction&quot;</span><span class="p">])</span>
        <span class="n">batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">break</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">graph_collate</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">cuda</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
<span class="n">predictions</span><span class="p">,</span> <span class="n">num_prediction</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>

<span class="n">top1_index</span> <span class="o">=</span> <span class="n">num_prediction</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">num_prediction</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">products</span><span class="p">)):</span>
    <span class="n">reactant</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[</span><span class="n">top1_index</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">connected_components</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">products</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">connected_components</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">reaction</span><span class="p">(</span><span class="n">reactant</span><span class="p">,</span> <span class="n">product</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/uspto50k_retrosynthesis_g2gs_valid_0.png"><img alt="../_images/uspto50k_retrosynthesis_g2gs_valid_0.png" src="../_images/uspto50k_retrosynthesis_g2gs_valid_0.png" style="width: 49%;" /></a>
<a class="reference internal image-reference" href="../_images/uspto50k_retrosynthesis_g2gs_valid_1.png"><img alt="../_images/uspto50k_retrosynthesis_g2gs_valid_1.png" src="../_images/uspto50k_retrosynthesis_g2gs_valid_1.png" style="width: 49%;" /></a>
<a class="reference internal image-reference" href="../_images/uspto50k_retrosynthesis_g2gs_valid_2.png"><img alt="../_images/uspto50k_retrosynthesis_g2gs_valid_2.png" src="../_images/uspto50k_retrosynthesis_g2gs_valid_2.png" style="width: 49%;" /></a>
<a class="reference internal image-reference" href="../_images/uspto50k_retrosynthesis_g2gs_valid_3.png"><img alt="../_images/uspto50k_retrosynthesis_g2gs_valid_3.png" src="../_images/uspto50k_retrosynthesis_g2gs_valid_3.png" style="width: 49%;" /></a>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="link_prediction.html" class="btn btn-neutral float-right" title="Link Prediction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="generation.html" class="btn btn-neutral float-left" title="Molecule Generation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, MilaGraph Group

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>